[mcu mmboard]
serial: /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0

[respond]
default_type: command

# MKS Gen L V1
[extruder_stepper motor1]
extruder: 
step_pin: mmboard:PF0
dir_pin: !mmboard:PF1
enable_pin: !mmboard:PD7
microsteps: 16
rotation_distance: 40
full_steps_per_rotation: 400

[manual_stepper motor2]
step_pin: mmboard:PF6
dir_pin: !mmboard:PF7
enable_pin: !mmboard:PF2
microsteps: 16
rotation_distance: 40
full_steps_per_rotation: 400

[manual_stepper motor3]
step_pin: mmboard:PL3
dir_pin: !mmboard:PL1
enable_pin: !mmboard:PK0
microsteps: 16
rotation_distance: 40
full_steps_per_rotation: 400

[manual_stepper motor4] #is currently working
step_pin: mmboard:PA4
dir_pin: !mmboard:PA6
enable_pin: !mmboard:PA2
microsteps: 16
rotation_distance: 40
full_steps_per_rotation: 400

[manual_stepper motor5] # Initial setup for testing motor 5
step_pin: mmboard:PC1
dir_pin: !mmboard:PC3
enable_pin: !mmboard:PC7
microsteps: 16
rotation_distance: 40
full_steps_per_rotation: 400



[save_variables]
filename:MMU-variables.

# SAVE_VARIABLE VARIABLE=temperature_target VALUE={TARGET_TEMP}

# variable_selected_filament: 0 # no filament loaded
[gcode_macro SELECT_FILAMENT]
description: Selects a filament by setting the appropriate variables, moving the stepper motor, and adjusting pin states.
gcode:
    G91
    {% if params.FILAMENT|int == 2 %}
        M118 loading filament 2
        SAVE_VARIABLE VARIABLE= VALUE=
        SELECT_motor2
    {% elif params.FILAMENT|int == 3 %}
        M118 loading filament 3
        SELECT_motor3
    {% elif params.FILAMENT|int == 4 %}
        M118 loading filament 4
        SELECT_motor4
    {% else %}
        M118 loading filament 1
        SELECT_motor1
    {% endif %}

# SELECT_FILAMENT FILAMENT=1  ; Selects motor1
# SELECT_FILAMENT FILAMENT=2  ; Selects motor2
# SELECT_FILAMENT FILAMENT=3  ; Selects motor3
# SELECT_FILAMENT FILAMENT=4  ; Selects motor4

[gcode_macro SELECT_motor1]
description: Selects filament 1 by setting the appropriate variables, moving the stepper motor, and adjusting pin states.
gcode:
    G91 
    MANUAL_STEPPER STEPPER=motor1 MOVE=100
    G90


[gcode_macro SELECT_motor2]
description: Selects filament 2 by setting the appropriate variables, moving the stepper motor, and adjusting pin states.
gcode:
    G91 
    MANUAL_STEPPER STEPPER=motor2 MOVE=100
    G90


[gcode_macro SELECT_motor3]
description: Selects filament 3 by setting the appropriate variables, moving the stepper motor, and adjusting pin states.
gcode:
    G91 
    MANUAL_STEPPER STEPPER=motor3 MOVE=100
    G90

[gcode_macro SELECT_motor4]
gcode:
    G91 
    MANUAL_STEPPER STEPPER=motor4 MOVE=100
    G90

[gcode_macro LOAD_motor1]
gcode:
    SELECT_FILAMENT FILAMENT=1
[gcode_macro LOAD_motor2]
gcode:
    SELECT_FILAMENT FILAMENT=2
[gcode_macro LOAD_motor3]
gcode:
    SELECT_FILAMENT FILAMENT=3
[gcode_macro LOAD_motor4]
gcode:
    SELECT_FILAMENT FILAMENT=4
[gcode_macro LOAD_motor5]
gcode:
    SELECT_FILAMENT FILAMENT=5

[gcode_macro SYNC_motor1]
gcode:
    [extruder_stepper motor1]
    extruder: extruder

[gcode_macro OFF_motor1]
gcode:
    MANUAL_STEPPER STEPPER=motor1 ENABLE=0

[gcode_macro OFF_manual_stepper]
gcode:
    MANUAL_STEPPER STEPPER=motor1 ENABLE=0

[gcode_macro OFF_motor3]
gcode:
    MANUAL_STEPPER STEPPER=motor3 ENABLE=0

#find out why motor 1 and 2 act different to 3 and 4

#test motor 5

# start thinking about how I want the filament sensors to act
